# Fast Sandbox

Fast Sandbox æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€äº‘åŸç”Ÿï¼ˆKubernetes-nativeï¼‰çš„æ²™ç®±ç®¡ç†ç³»ç»Ÿï¼Œæ—¨åœ¨ä¸º AI Agentã€Serverless å‡½æ•°å’Œè®¡ç®—å¯†é›†å‹ä»»åŠ¡æä¾›**æ¯«ç§’çº§çš„å®¹å™¨å†·å¯åŠ¨**ä¸**å—æ§è‡ªæ„ˆ**èƒ½åŠ›ã€‚

é€šè¿‡é¢„çƒ­ "Agent Pod" èµ„æºæ± å¹¶ç›´æ¥é›†æˆå®¿ä¸»æœºå±‚é¢çš„å®¹å™¨ç®¡ç†èƒ½åŠ›ï¼ŒFast Sandbox ç»•è¿‡äº†ä¼ ç»Ÿ Kubernetes Pod åˆ›å»ºçš„å·¨å¤§å¼€é”€ï¼Œå®ç°äº†æé€Ÿçš„ä»»åŠ¡åˆ†å‘ä¸ç‰©ç†éš”ç¦»ã€‚

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

*   **âš¡ï¸ æé€Ÿå¯åŠ¨ (Fast-Path API)**: å¼•å…¥ gRPC Fast-Path æœºåˆ¶ï¼Œæ”¯æŒ **<50ms** çš„ç«¯åˆ°ç«¯å¯åŠ¨å»¶è¿Ÿã€‚æ”¯æŒ **Fast Mode** (Agent-First, æé€Ÿ) å’Œ **Strong Mode** (CRD-First, å¼ºä¸€è‡´) åŒæ¨¡åˆ‡æ¢ã€‚
*   **ğŸ› ï¸ å¼€å‘è€… CLI (`fsb-ctl`)**: æä¾›ç±»ä¼¼ Docker çš„å‘½ä»¤è¡Œä½“éªŒã€‚æ”¯æŒäº¤äº’å¼åˆ›å»ºã€é…ç½®ç®¡ç†ã€æ—¥å¿—æµå¼æŸ¥çœ‹ (`logs -f`) å’ŒçŠ¶æ€æŸ¥è¯¢ã€‚
*   **ğŸ’¾ é›¶æ‹‰å–å¯åŠ¨**: åˆ©ç”¨ **Host Containerd é›†æˆ** æŠ€æœ¯ï¼Œç›´æ¥åœ¨å®¿ä¸»æœºä¸Šå¯åŠ¨å¾®å®¹å™¨ï¼Œå¤ç”¨èŠ‚ç‚¹é•œåƒç¼“å­˜ã€‚
*   **âš–ï¸ æ™ºèƒ½è°ƒåº¦**: åŸºäº **é•œåƒäº²å’Œæ€§ (Image Affinity)** å’Œ **åŸå­æ’æ§½ (Slot)** çš„è°ƒåº¦ç®—æ³•ï¼Œå½»åº•æ¶ˆé™¤é•œåƒæ‹‰å–å»¶è¿Ÿå¹¶é¿å…ç«¯å£å†²çªã€‚
*   **ğŸ›¡ï¸ å¥å£®æ€§è®¾è®¡**:
    *   **å—æ§è‡ªæ„ˆ**: æ”¯æŒ `AutoRecreate` ç­–ç•¥å’Œæ‰‹åŠ¨ `resetRevision`ã€‚
    *   **ä¼˜é›…å…³é—­**: å®Œæ•´çš„ SIGTERM -> SIGKILL æµç¨‹ï¼Œé˜²æ­¢åƒµå°¸è¿›ç¨‹ã€‚
    *   **Node Janitor**: ç‹¬ç«‹ DaemonSet è‡ªåŠ¨å›æ”¶å­¤å„¿å®¹å™¨ä¸æ®‹ç•™æ–‡ä»¶ã€‚

## ğŸ— ç³»ç»Ÿæ¶æ„

ç³»ç»Ÿé‡‡ç”¨â€œæ§åˆ¶é¢é›†ä¸­å†³ç­–ï¼Œæ•°æ®é¢æé€Ÿæ‰§è¡Œâ€çš„æ¶æ„ï¼š

1.  **æ§åˆ¶é¢ (Control Plane)**:
    *   **Fast-Path Server (gRPC)**: å¤„ç†é«˜å¹¶å‘çš„æ²™ç®±åˆ›å»º/åˆ é™¤è¯·æ±‚ï¼Œç›´æ¥å¯¹æ¥ CLIã€‚
    *   **SandboxController**: è´Ÿè´£ CRD çŠ¶æ€æœºç»´æŠ¤ã€Finalizer èµ„æºå›æ”¶åŠåŒæ¨¡ä¸€è‡´æ€§åè°ƒã€‚
    *   **Atomic Registry**: å†…å­˜çº§çš„çŠ¶æ€ä¸­å¿ƒï¼Œæ”¯æŒé«˜å¹¶å‘ä¸‹çš„äº’æ–¥åˆ†é…ä¸é•œåƒæƒé‡è®¡ç®—ã€‚

2.  **æ•°æ®é¢ (Data Plane - Agent)**:
    *   è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šçš„ç‰¹æƒ Podï¼Œé€šè¿‡ gRPC/HTTP ä¸æ§åˆ¶é¢é€šä¿¡ã€‚
    *   **Runtime Integration**: ç›´æ¥è°ƒç”¨å®¿ä¸»æœº Containerd Socketï¼Œå®ç°å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œ**æ—¥å¿—æŒä¹…åŒ–**ã€‚

3.  **å·¥å…·é“¾ (Tooling)**:
    *   **fsb-ctl**: å¼€å‘è€… CLIï¼Œæ”¯æŒ `run`, `list`, `get`, `logs`, `delete` ç­‰å‘½ä»¤ã€‚

## ğŸ›  å¿«é€Ÿå¼€å§‹

### 1. å®‰è£… CLI
```bash
make build
# ç”Ÿæˆ bin/fsb-ctl
export PATH=$PWD/bin:$PATH
```

### 2. å¯åŠ¨æ²™ç®± (äº¤äº’æ¨¡å¼)
```bash
fsb-ctl run my-sandbox
# å°†è‡ªåŠ¨æ‰“å¼€ç¼–è¾‘å™¨ä¾›æ‚¨é…ç½®é•œåƒã€ç«¯å£å’Œå‘½ä»¤
```

### 3. æŸ¥çœ‹å®æ—¶æ—¥å¿—
```bash
fsb-ctl logs my-sandbox -f
```

### 4. å£°æ˜å¼å®šä¹‰ (YAML)
æ‚¨ä¹Ÿå¯ä»¥ç›´æ¥æ“ä½œ Kubernetes CRDï¼š

```yaml
apiVersion: sandbox.fast.io/v1alpha1
kind: Sandbox
spec:
  image: alpine:latest
  exposedPorts: [8080]
  poolRef: default-pool
  consistencyMode: fast  # æˆ– strong
  failurePolicy: AutoRecreate
```

## ğŸ“„ è®¸å¯è¯

[MIT](LICENSE)