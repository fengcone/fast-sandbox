syntax = "proto3";

package fastpath.v1;

option go_package = "fast-sandbox/api/v1;fastpathv1";

service FastPathService {
  // CreateSandbox 极速创建沙箱，绕过 K8s 控制面延迟
  rpc CreateSandbox(CreateRequest) returns (CreateResponse);

  // DeleteSandbox 极速删除沙箱
  rpc DeleteSandbox(DeleteRequest) returns (DeleteResponse);
}

// ConsistencyMode 定义创建 sandbox 的一致性模式
enum ConsistencyMode {
  // FAST 模式：先创建 Agent，后写 CRD（默认）
  // 最低延迟，但 CRD 写入失败可能导致正在使用的 sandbox 被清理
  FAST = 0;

  // STRONG 模式：先写 CRD，后创建 Agent
  // 延迟略高，但保证强一致性
  STRONG = 1;
}

message CreateRequest {
  string image = 1;
  string pool_ref = 2;
  repeated int32 exposed_ports = 3;
  repeated string command = 4;
  repeated string args = 5;
  string namespace = 6; // 可选，默认为 "default"
  ConsistencyMode consistency_mode = 7; // 可选，默认使用 Controller 配置
}

message CreateResponse {
  string sandbox_id = 1;
  string agent_pod = 2;
  repeated string endpoints = 3; // IP:Port 列表
}

message DeleteRequest {
  string sandbox_id = 1;
  string namespace = 2; // 可选，默认为 "default"
}

message DeleteResponse {
  bool success = 1;
}
