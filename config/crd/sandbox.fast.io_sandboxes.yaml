apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: sandboxes.sandbox.fast.io
spec:
  group: sandbox.fast.io
  names:
    kind: Sandbox
    listKind: SandboxList
    plural: sandboxes
    singular: sandbox
  scope: Namespaced
  versions:
  - name: v1alpha1
    served: true
    storage: true
    schema:
      openAPIV3Schema:
        type: object
        properties:
          spec:
            type: object
            required: ["image", "poolRef"]
            properties:
              image:
                type: string
                description: "Container image to run (e.g., nginx:alpine)"
                minLength: 1
              command:
                type: array
                items: {type: string}
                description: "Override the image's ENTRYPOINT"
              args:
                type: array
                items: {type: string}
                description: "Override the image's CMD"
              envs:
                type: array
                items:
                  type: object
                  required: ["name"]
                  properties:
                    name: {type: string}
                    value: {type: string}
                    valueFrom: {type: object}
                description: "Environment variables to set in the container"
              workingDir:
                type: string
                description: "Container's working directory"
              poolRef:
                type: string
                description: "Name of the SandboxPool to schedule this sandbox to"
                minLength: 1
              expireTime: {type: string, format: date-time}
              exposedPorts:
                type: array
                items:
                  type: integer
                  minimum: 1
                  maximum: 65535
                description: "Ports the application listens on"
              failurePolicy:
                type: string
                enum: ["Manual", "AutoRecreate"]
                default: "Manual"
                description: "Recovery strategy when agent is lost"
              recoveryTimeoutSeconds:
                type: integer
                minimum: 1
                default: 60
                description: "Seconds to wait before recovery action"
              resetRevision: {type: string, format: date-time}
          status:
            type: object
            properties:
              phase: {type: string}
              assignedPod: {type: string}
              nodeName: {type: string}
              sandboxID: {type: string}
              endpoints: {type: array, items: {type: string}}
              acceptedResetRevision: {type: string, format: date-time}
              conditions:
                type: array
                items:
                  type: object
                  properties:
                    type: {type: string}
                    status: {type: string}
                    reason: {type: string}
                    message: {type: string}
                    lastTransitionTime: {type: string, format: date-time}
    subresources:
      status: {}
